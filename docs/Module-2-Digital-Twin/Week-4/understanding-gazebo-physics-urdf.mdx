---
title: "Understanding Gazebo Physics and URDF"
sidebar_position: 2
---

# Understanding Gazebo Physics and URDF

## Learning Objectives

By the end of this chapter, you should be able to:
- Explain the relationship between URDF and Gazebo physics simulation
- Understand the key physics concepts in Gazebo relevant to humanoid robots
- Configure realistic physical properties for humanoid robot models
- Troubleshoot common physics-related issues in simulation
- Optimize physics parameters for stable humanoid simulation
- Implement proper mass, inertia, and collision properties for humanoid links

## Introduction to Physics in Robotics Simulation

Physics simulation is fundamental to realistic robot behavior in Gazebo. For humanoid robots, which have complex multi-link mechanisms with many degrees of freedom, accurate physics simulation is crucial for developing and testing control algorithms. This chapter delves deep into the physics concepts that govern how humanoid robots behave in simulation and how to configure these properly for realistic behavior.

## Core Physics Concepts in Gazebo

### Rigid Body Dynamics

Gazebo simulates rigid body dynamics using the Open Dynamics Engine (ODE), which solves for:
- **Position and orientation** of rigid bodies over time
- **Linear and angular velocities** of bodies
- **Forces and torques** applied to bodies
- **Constraints** imposed by joints between bodies

For humanoid robots, this means each link is treated as a rigid body, and the dynamics solve for how these bodies move under the influence of actuators, gravity, and contact forces.

### Newtonian Mechanics in Simulation

The simulation is based on Newton's laws of motion:
- **F = ma**: Force equals mass times acceleration
- **Conservation of momentum**: Total momentum remains constant without external forces
- **Conservation of energy**: Energy transforms between kinetic and potential forms

In the context of humanoid robots, these laws govern how limbs move under actuator forces, how the robot responds to impacts, and how it maintains balance.

### Time Integration

Gazebo uses numerical integration to solve the equations of motion:
- **Step size**: The time increment for each simulation step
- **Integration method**: How the physics solver advances the state
- **Real-time factor**: How simulation time relates to wall-clock time

## URDF: The Foundation of Physics Simulation

### URDF Overview

URDF (Unified Robot Description Format) is an XML format that describes robot models for ROS and Gazebo. For physics simulation, URDF provides:

- **Kinematic structure**: How links are connected by joints
- **Physical properties**: Mass, center of mass, and inertia
- **Collision geometry**: Shapes for collision detection
- **Visual geometry**: Shapes for visualization (may differ from collision)

### Link Definition and Physical Properties

Each link in a URDF must have proper physical properties:

```xml
<link name="thigh_link">
  <!-- Visual properties for rendering -->
  <visual>
    <origin xyz="0 0 -0.2" rpy="0 0 0"/>
    <geometry>
      <cylinder radius="0.05" length="0.4"/>
    </geometry>
    <material name="light_grey">
      <color rgba="0.7 0.7 0.7 1.0"/>
    </material>
  </visual>

  <!-- Collision properties for physics -->
  <collision>
    <origin xyz="0 0 -0.2" rpy="0 0 0"/>
    <geometry>
      <cylinder radius="0.05" length="0.4"/>
    </geometry>
  </collision>

  <!-- Inertial properties for dynamics -->
  <inertial>
    <origin xyz="0 0 -0.2" rpy="0 0 0"/>
    <mass value="3.5"/>
    <inertia ixx="0.042" ixy="0.0" ixz="0.0" 
             iyy="0.042" iyz="0.0" izz="0.009"/>
  </inertial>
</link>
```

### Joint Definition and Constraints

Joints define how links can move relative to each other:

```xml
<joint name="hip_pitch_joint" type="revolute">
  <parent link="torso"/>
  <child link="thigh_link"/>
  <origin xyz="0.0 0.1 -0.05" rpy="0 0 0"/>
  <axis xyz="1 0 0"/>  <!-- Rotation about X-axis -->
  <limit lower="-1.2" upper="0.8" effort="100.0" velocity="2.0"/>
  <dynamics damping="0.5" friction="0.1"/>
</joint>
```

Joint types relevant to humanoid robots:
- **revolute**: Single-axis rotation (like a hinge)
- **prismatic**: Single-axis translation
- **continuous**: Unlimited rotation (like a wheel)
- **fixed**: No movement between links

### Inertial Properties

Accurate inertial properties are crucial for realistic physics:

#### Mass
- Represents the amount of matter in a link
- Should match the real robot's mass as closely as possible
- Measured in kilograms (kg)

#### Center of Mass
- Point where mass can be considered concentrated
- Critical for balance and stability
- Measured as offset from link origin (meters)

#### Inertia Tensor
- Describes how mass is distributed around the center of mass
- Affects how links rotate under applied torques
- Represented by the 3x3 inertia matrix (kg·m²)

For a humanoid thigh link with mass 3.5kg and 40cm length, 10cm radius:
- ixx = mass * (3*radius² + length²)/12 = 3.5 * (3*0.05² + 0.4²)/12
- iyy = same as ixx (symmetric about y-axis)
- izz = mass * radius² / 2 = 3.5 * 0.05² / 2

## Gazebo Physics Configuration

### Physics Engine Parameters

The Gazebo physics engine has parameters that affect simulation quality:

#### Solver Parameters
- **Type**: Quick (iterative) vs. PGS (Projected Gauss-Seidel) vs. Dantzig
- **Iterations**: Number of iterations to solve constraints (more = more accurate but slower)
- **SOR (Successive Over Relaxation)**: Relaxation factor for iterative solver

#### Constraint Parameters
- **CFM (Constraint Force Mixing)**: Softness parameter for constraints
- **ERP (Error Reduction Parameter)**: How quickly constraint errors are corrected
- **Contact parameters**: How contacts between objects are handled

### World Physics Configuration

Physics parameters are defined in SDF world files:

```xml
<world name="humanoid_world">
  <physics type="ode">
    <!-- Time stepping -->
    <max_step_size>0.001</max_step_size>
    <real_time_factor>1.0</real_time_factor>
    <real_time_update_rate>1000.0</real_time_update_rate>
    
    <!-- Gravity -->
    <gravity>0 0 -9.8</gravity>
    
    <!-- ODE parameters -->
    <ode>
      <solver>
        <type>quick</type>
        <iters>100</iters>        <!-- Solver iterations -->
        <sor>1.3</sor>            <!-- SOR factor -->
      </solver>
      
      <constraints>
        <cfm>0.000001</cfm>       <!-- Constraint Force Mixing -->
        <erp>0.2</erp>            <!-- Error Reduction Parameter -->
        <contact_max_correcting_vel>100.0</contact_max_correcting_vel>
        <contact_surface_layer>0.001</contact_surface_layer>
      </constraints>
    </ode>
  </physics>
</world>
```

## Physics for Humanoid-Specific Components

### Balance and Center of Mass

Humanoid robots require careful attention to balance:

#### Center of Mass Calculation
```xml
<!-- Example torso link with complex CoM -->
<inertial>
  <origin xyz="0.01 0.0 0.02" rpy="0 0 0"/>  <!-- Offset CoM -->
  <mass value="10.0"/>
  <inertia 
    ixx="0.15" ixy="0.001" ixz="0.005" 
    iyy="0.12" iyz="0.002" izz="0.08"/>
</inertial>
```

For humanoid balance:
- Keep CoM within the support polygon (area under feet)
- Consider the effect of arm and head positions on CoM
- Use accurate mass distribution for realistic balance

### Joint Actuation and Dynamics

#### Joint Limits and Safety
```xml
<joint name="knee_joint" type="revolute">
  <parent link="thigh"/>
  <child link="shank"/>
  <axis xyz="1 0 0"/>
  <limit lower="0" upper="2.5" effort="150.0" velocity="3.0"/>
  <dynamics damping="1.0" friction="0.2"/>
  <safety_controller k_position="10" k_velocity="0.1" 
                     soft_lower_limit="-0.1" soft_upper_limit="2.4"/>
</joint>
```

#### Transmission Elements
```xml
<transmission name="knee_transmission">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="knee_joint">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="knee_motor">
    <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>
```

### Contact and Friction Properties

For humanoid feet and hands:
```xml
<gazebo reference="left_foot">
  <collision>
    <surface>
      <friction>
        <ode>
          <mu>0.8</mu>      <!-- Primary friction coefficient -->
          <mu2>0.8</mu2>    <!-- Secondary friction coefficient -->
        </ode>
      </friction>
      <bounce>
        <restitution_coefficient>0.01</restitution_coefficient>
      </bounce>
      <contact>
        <ode>
          <kp>1e6</kp>      <!-- Contact stiffness -->
          <kd>10</kd>       <!-- Contact damping -->
          <max_vel>100.0</max_vel>
          <min_depth>0.001</min_depth>
        </ode>
      </contact>
    </surface>
  </collision>
</gazebo>
```

## Physics Optimization for Humanoid Robots

### Simulation Stability

For stable humanoid simulation:

#### Time Step Selection
- Smaller time steps = more accurate but slower simulation
- Joint constraint errors scale with step size squared
- For humanoid robots, often use 0.001s to 0.0001s

#### Solver Iterations
- More iterations = better constraint satisfaction
- Humanoid robots typically need 100-500 iterations
- Higher values increase computational cost

#### Constraint Parameters
- ERP too high → unstable oscillations
- ERP too low → constraint violations
- CFM too high → soft constraints (objects penetrate)
- CFM too low → solver instability

### Performance Considerations

#### Collision Mesh Optimization
```xml
<!-- Use simplified collision geometry -->
<collision>
  <geometry>
    <!-- Instead of complex mesh, use primitives -->
    <mesh filename="package://my_robot/meshes/foot_collision.stl"/>
    <!-- Or use simpler shapes -->
    <box size="0.2 0.1 0.05"/>
  </geometry>
</collision>
```

#### Mass Distribution Optimization
- Use realistic but stable mass values
- Consider using slightly higher damping for stability
- Balance accuracy with computational efficiency

## Advanced Physics Concepts

### Impulse-Based Dynamics

Gazebo uses impulse-based methods for solving contact problems:
- Contact forces are applied as impulses
- Constraints are satisfied iteratively
- This approach handles multiple contacts well

### Soft Contacts

For more realistic contact behavior:
- Model soft contacts with springs and dampers
- Use appropriate stiffness and damping parameters
- Consider the effect of soft contacts on control algorithms

### Multi-Body Constraints

For complex humanoid mechanisms:
- Closed-loop mechanisms require special handling
- Redundant constraints can cause simulation issues
- Use appropriate constraint solvers for closed kinematic chains

## Troubleshooting Physics Issues

### Common Problems and Solutions

#### Jittery or Unstable Motion
**Symptoms**: Oscillations, vibrating joints, unstable balance
**Solutions**:
- Increase solver iterations
- Adjust ERP and CFM values
- Verify mass and inertia values
- Add damping to joints

#### Object Penetration
**Symptoms**: Links passing through each other or ground
**Solutions**:
- Decrease time step (increase update rate)
- Increase contact stiffness (kp) and damping (kd)
- Simplify or repair collision meshes
- Verify mesh scaling

#### Exploding Simulation
**Symptoms**: Robot flying away, extreme joint velocities
**Solutions**:
- Check for impossible mass/inertia values
- Verify joint limits and dynamics
- Reduce control gains in real controllers
- Check for singular configurations

#### Inaccurate Dynamics
**Symptoms**: Too stable/unstable compared to real robot
**Solutions**:
- Verify mass and inertia properties
- Adjust friction coefficients
- Compare with real robot behavior
- Fine-tune damping values

### Debugging Physics

#### Tools and Techniques
- Use Gazebo's physics visualization tools
- Monitor joint positions, velocities, and efforts
- Compare simulation vs. theoretical kinematics
- Use TF trees to verify kinematic relationships

#### Validation Methods
- Compare with analytical models
- Verify conservation laws (energy, momentum)
- Test with simple known systems first
- Gradually increase complexity

## Physics for Control Integration

### Physics-Controller Interaction

The physics simulation interacts with controllers through:
- Joint position/velocity/effort interfaces
- Sensor feedback (IMU, joint encoders, force sensors)
- Real-time constraints and update rates

### Controller Physics Considerations

When designing controllers for simulation:
- Account for simulation delays
- Consider discrete-time effects
- Handle different physics parameters than reality
- Design for both simulation and real robot compatibility

## Exercises and Self-Check

1. **Physics Parameter Tuning**: Adjust the physics parameters in a simple humanoid model to achieve stable standing balance with realistic movement characteristics.

2. **Inertia Calculation**: Given a humanoid link with specific dimensions and material properties, calculate the correct mass and inertia tensor values.

3. **Collision Optimization**: Create simplified collision geometries for a complex humanoid model that maintain accuracy while improving simulation performance.

4. **Stability Analysis**: Identify potential sources of instability in a humanoid URDF model and propose physics parameter adjustments to improve stability.

5. **Contact Modeling**: Configure realistic contact properties for humanoid feet that enable stable walking in simulation.

## Summary

Understanding the relationship between URDF and Gazebo physics is crucial for creating realistic humanoid simulations. The physical properties defined in URDF directly determine how the robot behaves in simulation, affecting everything from basic movement to complex dynamic behaviors like walking and balance.

Proper configuration of mass, inertia, and contact properties, combined with appropriate physics parameters, creates a stable and realistic simulation environment. This foundation is essential for developing and testing control algorithms before deployment on physical hardware.

The next chapter will explore how to simulate sensors in Gazebo, which together with proper physics simulation, provides a complete environment for developing humanoid robot behaviors.

---

**Keywords**: Gazebo Physics, URDF, Rigid Body Dynamics, Inertia, Collision, Joint Constraints, Physics Simulation, Humanoid Robotics